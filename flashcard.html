<html>
<head>
  <title>Simple Flash Cards w/JS</title>
  <!-- Font Awesome 6.5.1 via cdnjs -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style type="text/css">
    body {
      font-family: sans-serif;
      padding: 25px;
    }
    #card-wrapper {
      width: 25rem;
      height: 200px;
      margin: 25px;
    }
    #card-body {
      position: relative;
      width: 100%;
      height: 100%;
      text-align: center;
      padding: 25px;
      box-shadow: 0 15px 35px rgba(0,0,0,0.2),0 5px 15px rgba(0,0,0,0.19);
    }
    #question {
      padding: 30px;
      min-height: 40px;
    }
    #answer {

    }
    /* media queries */
    @media (min-width: 300px) {
      #card-wrapper {
        width: 75%;
      }
    }
    @media (min-width: 600px) {
      #card-wrapper {
      width: 80%;
    }
  }
  </style>
  <!-- Include Tin Can API / xAPI via CDN --> 
  <script src="https://cdn.jsdelivr.net/npm/tincanjs@0.50.0/build/tincan-min.min.js"></script>

  <!-- App Logic --> 
  <script type="text/javascript">
  // make sure the page has loaded before you try to call .innerHTML
  window.onload = function(){
    const cards = [
      {
        question: "What is the capital of France?",
        answer: "Paris",
      },
      {
        question: "What is the largest ocean in the world?",
        answer: "The Pacific Ocean",
      },
      {
        question: "What is the square root of 16?",
        answer: "4",
      },
    ];

    console.log(cards)

    let currentCardIndex = 0;
    const frontOfCardColor = "lightslategray";
    const backOfCardColor = "lightgray";

    function showCard() {
      const card = cards[currentCardIndex];
      document.getElementById("question").innerHTML = card.question;
      document.getElementById("answer").innerHTML = "";
      document.getElementById("card-body").style.backgroundColor = frontOfCardColor; 
      console.log("currentCardIndex:" + currentCardIndex)
    }

    function flipCard() {
      const card = cards[currentCardIndex];
      const displayElement = document.getElementById("question");
      displayElement.innerHTML = displayElement.innerHTML === card.question ? card.answer : card.question;
      if (displayElement.innerHTML == card.answer) {
        document.getElementById("card-body").style.backgroundColor = backOfCardColor;
        document.getElementById('card-body').style.transition = "background-color 0.25s linear"; 
      } else {
        document.getElementById("card-body").style.backgroundColor = frontOfCardColor;
      }
    }

    function nextCard() {
      currentCardIndex++;
      if (currentCardIndex >= cards.length) {
        currentCardIndex = 0;
      }
      showCard();
    }

    function previousCard() {
      if (currentCardIndex <= cards.length) {
        currentCardIndex = 0;
      }
      showCard()
    }

    showCard();
    document.getElementById("previous-button").addEventListener("click", previousCard);
    document.getElementById("flip-button").addEventListener("click", flipCard);
    document.getElementById("next-button").addEventListener("click", nextCard);

    /* xAPI */
    // Connect to LRS
    var lrs;

    try {
        lrs = new TinCan.LRS(
            {
                endpoint: "https://simpleflashcardgithubdemo.lrs.io/xapi/",
                username: "GitHubKey",
                password: "0cL,E2G8h*2#",
                allowFail: false
            }
        );
        console.log("LRS connection established")
    }
    catch (ex) {
        console.log("Failed to setup LRS object: ", ex);
        // TODO: do something with error, can't communicate with LRS
    }

    // Prep an xAPI Statement
    var statement = new TinCan.Statement(
      {
          actor: {
              mbox: "mailto:xapi@example.com"
          },
          verb: {
              id: "http://adlnet.gov/expapi/verbs/experienced"
          },
          target: {
              id: "https://github.com/uarkjames/simpleflashcard"
          }
      }
    );

    // Send an Async xAPI Statement
    lrs.saveStatement(
    statement,
      {
          callback: function (err, xhr) {
              if (err !== null) {
                  if (xhr !== null) {
                      console.log("Failed to save async xAPI statement: " + xhr.responseText + " (" + xhr.status + ")");
                      // TODO: do something with error, didn't save statement
                      return;
                  }

                  console.log("Failed to save async xAPI statement: " + err);
                  // TODO: do something with error, didn't save statement
                  return;
              }

              console.log("Async xAPI statement saved");
              // TOOO: do something with success (possibly ignore)
          }
      }
    );

 
  } // Don't delete me
  </script>
</head>
<body>

<div id="card-wrapper">
  <div id="card-body">
    <div id="question"></div>
    <div id="answer"></div>
    <button id="previous-button"><i class="fa-sharp fa-solid fa-arrow-left"></i> Previous</button>
    <button id="flip-button"><i class="fa-solid fa-repeat"></i> Flip Card</button>
    <button id="next-button">Next <i class="fa-sharp fa-solid fa-arrow-right"></i></button>
  </div><!-- /card-wrapper -->
</div><!-- /card-body -->

<p>&nbsp;</p>
<p>&nbsp;</p>

<!-- 
To Do
[ ] Make it accessible
-->

</body>
</html>
