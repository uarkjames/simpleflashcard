<html>
<head>
  <title>Simple Flash Cards w/JS</title>
  <!-- Font Awesome 6.5.1 via cdnjs -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style type="text/css">
    body {
      font-family: sans-serif;
      padding: 25px;
    }
    #card-wrapper {
      width: 25rem;
      height: 400px; /* 200px */
      margin: 25px;
      margin-bottom: 75px;
    }
    #card-body {
      position: relative;
      width: 100%;
      height: 100%;
      text-align: center;
      padding: 25px;
      box-shadow: 0 15px 35px rgba(0,0,0,0.2),0 5px 15px rgba(0,0,0,0.19);
    }
    #buttons-wrapper {
      padding: 5px;
    }
    #question {
      padding-top: 20px;
      min-height: 40px;
      font-size: 18px;
      font-weight: bold;
    }
    #answer {

    }
    #answerImage {
      max-height: 300px;
      max-width: 300px;
    }

    /* media queries */
    @media (min-width: 300px) {
      #card-wrapper {
        width: 75%;
      }
    }
    @media (min-width: 600px) {
      #card-wrapper {
      width: 80%;
    }
  }
  </style>
  <!-- Include Tin Can API / xAPI via CDN --> 
  <script src="https://cdn.jsdelivr.net/npm/tincanjs@0.50.0/build/tincan-min.min.js"></script>

  <!-- App Logic --> 
  <script type="text/javascript">
  // make sure the page has loaded before you try to call .innerHTML
  window.onload = function(){
    const cards = [
      {
        question: "What is the capital of France?",
        answer: "Paris",
        questionImage: "https://previews.dropbox.com/p/thumb/ACM9Mt2Qm-8mu8BYpUmv8wqgFNEN4x4Eq9W7YP9FZiYUMZW7TpCbTspp5PVpyGVIwP3MWkfZQ4JjWMDyEyRcEakVWLI48Uaz53h0pwcJ4No6FtjoDtUuI7XEseXF9zEpdXSs1qf3HDCVgRcE3ryxdhvcqpV7FefDXXFnEHNZYlxpld-duGCNQxY7pFKJGCThm-jBysl1YgcggsYDL0VVhmqW2cbeDtVEF6kii2OowRkbTelVFlrB1LAbLsDZMUk_p4YTNS8j_JggRx944wMts5amoS1hmcJYTEgiLFekPrOCkAJ-2O8-PKuc259-_kX0nuLzjY9sVpg3oeHf-Jgwua1Y/p.png", 
        answerImage: "https://previews.dropbox.com/p/thumb/ACMT2tu5NYrv0nkTbBoY4gb4h4M7EMQ_Er0MJRGCirJxR-a49K5zc6v2qUGnn_QKhEGUdJdWI3aw-VLkQs5rwUXC9VS5NN96b1JyNat_c5vIaduXD5ix6GNPszNfIU3GyU_7IHVI2Z3yYGKvIRSAADqtAoJqGr-k1zS3xOPut_yzFDEAQsbQDueYthJz8uui9un5wJ6pCGNNTB9nbrizitpKwgl1XPBgeDo1c0OM1hydiFgdmlt9iXKde1zR8NZCfF3NLekmnWg0iG-bhagdVvMCKeSG3b1p2NbJjdN_OBGolGWgBUmOhCTh4B2u_Clp3uIsQklp1e7PWEso7wC2LgN_/p.jpeg", 
      },
      {
        question: "What is the largest ocean in the world?",
        answer: "The Pacific Ocean",
        questionImage: "https://previews.dropbox.com/p/thumb/ACNjLlWCLRlN2DBvD-1ZzVNXNSwWKNYnqexa40sB-BtCiwTASTCKxy0tWvqSNS9NDx_c2ex0jEsGfOL5DJBu88MTWYwr2h1kAfUJVPXqbUbFzzgRBbXWlumavsu8QzroOd0mOxVdh8-0_669D-QO3wWuDzq-C7GNWFe5hTNgQbtSGBZUE_K9CN0Wd7caXdLMidN7YZ3u6xGRfNqu1FYJjaARpv9Esd4hlFLM2Z8Acmzf82D8-1JzflW-sKk7AWWe5PmZlEZBfLIguyJ5VbijhepUuWTSIucj9lc8dTDAkW_MSXsgK84bcbHklYCTCQWc6GeaGpID3MkwifrrJs30KO0D/p.jpeg", 
        answerImage: "https://previews.dropbox.com/p/thumb/ACNFYns7Ukmj6WsBL-H-UUXSMVdNkh3km-Abxs2nPUvo426Ol_2t_BaYML6Ohaa8r7WC9OBWTCwffBC2Khl4MKdmN--QgbazA-69HkYY23oKS4Fo18Y7fj0yx9vqxnMQzwr1b9qH0FL_bC6F3h0KcvnIDSRJ9T9u9OBBlRMw-jBqR6BFVemUFGv9l1fOoBT4CdQqUWpndnXKPbGURLkjNBEZw_qMpYq37rHYY1mUIa4lOXJcuApoHCNwgmoXYotkSj7gx1OZafjp0NZFq3opx9YAe6auQOaULq_aLriMcLo2R4qp_nxIYXysnTF1-HjbbIAvzTAvxiG15Gocs5CQnpaQ/p.png",
      },
      {
        question: "What is the square root of 16?",
        answer: "4",
        questionImage: "https://previews.dropbox.com/p/thumb/ACMS6E3Fwys1VrCW2qQg_eRUGDDPUI1uxSEAyqDLkUzJF8oHp5Zk-6ss9gjQINgNRk0hg6AlILXVclGQrp5HjxGYNwsM9txSiP2IayTINaMJN1J0W3wdt4r_Ys4U5rrz2kUf1qFokk5-g-x8rCSXYeoIxv4WAw73SamC2fFj0IaVd7CezefYNcOnJasreSy1aYqYVXR1tuqGv1VotPEKvdQYhxP6C-a3GGiwEOHVizI48AywkGCySx_0DKfPE51DuoMxnaGrsx6lyb9Dwnkz0lTH9j9_RuvgurPDvF2q2Gg_Rzux3IrEbsNS4DgjxcikhOhLNZ9CgMeptAa6Lvb-fDVf/p.jpeg", 
        answerImage: "https://previews.dropbox.com/p/thumb/ACNem7OBXjgf12dc_2S7V6B-_odprWgjTNGEGGNkcrCLekBykEmvxX5CmPR6-eGdVqZ09bSZQ-pR34MZ53KFxR7QUokgdzHcMVqoMi3mC7wv2abG86AOa5eQSAwcwiW0skE-qaZPLOG3h8MFE-obdguSlwQ4yW2tj10EmjHsa2P0z_c8s6ovzE0yZflQbRoQ_urnk9gvCDWnTgLDSXMcnKLjb_myv6FwtxjSA46hWswAqRhZb2dXl9z53l_lU_Jo01BhrcTqVcKHlCpDRULweGpqmVU7l06o8NKJqzOrIVlqxEayR4kmxjt_5-GfXJnSOPS4Cn_GeiXtiX_v2mKcu1Va/p.jpeg",
      },
    ];

    console.log(cards)

    // preload images
    function preloadImages() {
      // Create an array to store the images
      const imagesToPreload = [];

      // Loop through the cards array
      cards.forEach(card => {
        // Create a new Image object for each question and answer image
        const questionImage = new Image();
        const answerImage = new Image();

        // Set the src properties to the image URLs
        questionImage.src = card.questionImage;
        answerImage.src = card.answerImage;

        // Push the images to the array
        imagesToPreload.push(questionImage, answerImage);
      });

      // Return a promise that resolves when all the images have loaded
      return Promise.all(imagesToPreload.map(image => {
        return new Promise(resolve => {
          image.onload = resolve;
          image.onerror = resolve;
        });
      }));
    }

    preloadImages().then(() => {
      console.log("All images have been preloaded.");
      // Now you can display the flashcards knowing that the images are already loaded
    });
    
    // assemble and display the card
    let currentCardIndex = 0;
    const frontOfCardColor = "lightslategray";
    const backOfCardColor = "lightgray";

    function showCard() {
      const card = cards[currentCardIndex];
      document.getElementById("question").innerHTML = card.question;
      document.getElementById("answer").innerHTML = "";
      document.getElementById('answerImage').src = card.questionImage;
      document.getElementById("card-body").style.backgroundColor = frontOfCardColor; 
      console.log("currentCardIndex:" + currentCardIndex)
    }

    // respond to the 'flip card' button
    function flipCard() {
      const card = cards[currentCardIndex];
      const displayElement = document.getElementById("question");
      displayElement.innerHTML = displayElement.innerHTML === card.question ? card.answer : card.question;
      if (displayElement.innerHTML == card.answer) {
        document.getElementById("card-body").style.backgroundColor = backOfCardColor;
        document.getElementById('card-body').style.transition = "background-color 0.25s linear";
        document.getElementById('answerImage').src = card.answerImage; 
      } else {
        document.getElementById("card-body").style.backgroundColor = frontOfCardColor; 
        document.getElementById('answerImage').src = card.questionImage;
      }
    }

    function nextCard() {
      currentCardIndex++;
      if (currentCardIndex >= cards.length) {
        currentCardIndex = 0;
      }
      showCard();
    }

    function previousCard() {
      if (currentCardIndex <= cards.length) {
        currentCardIndex = 0;
      }
      showCard()
    }

    showCard();
    document.getElementById("previous-button").addEventListener("click", previousCard);
    document.getElementById("flip-button").addEventListener("click", flipCard);
    document.getElementById("next-button").addEventListener("click", nextCard);

    /* xAPI */
    // Connect to LRS
    var lrs;

    try {
        lrs = new TinCan.LRS(
            {
                endpoint: "https://simpleflashcardgithubdemo.lrs.io/xapi/",
                username: "GitHubKey",
                password: "0cL,E2G8h*2#",
                allowFail: false
            }
        );
        console.log("LRS connection established")
    }
    catch (ex) {
        console.log("Failed to setup LRS object: ", ex);
        // TODO: do something with error, can't communicate with LRS
    }

    // Prep an xAPI Statement
    var statement = new TinCan.Statement(
      {
          actor: {
              mbox: "mailto:xapi@example.com"
          },
          verb: {
              id: "http://adlnet.gov/expapi/verbs/experienced"
          },
          target: {
              id: "https://github.com/uarkjames/simpleflashcard"
          }
      }
    );

    // Send an Async xAPI Statement
    lrs.saveStatement(
    statement,
      {
          callback: function (err, xhr) {
              if (err !== null) {
                  if (xhr !== null) {
                      console.log("Failed to save async xAPI statement: " + xhr.responseText + " (" + xhr.status + ")");
                      // TODO: do something with error, didn't save statement
                      return;
                  }

                  console.log("Failed to save async xAPI statement: " + err);
                  // TODO: do something with error, didn't save statement
                  return;
              }

              console.log("Async xAPI statement saved");
              // TOOO: do something with success (possibly ignore)
          }
      }
    );

 
  } // Don't delete me
  </script>
</head>
<body>

<div id="card-wrapper">
  <div id="card-body">
    <div id="question"></div>
    <div id="questionImage"><img src="" /></div>
    <div id="answer"></div>
    <div id="answerImageContainer"><img id="answerImage" src="" /></div>
    <div id="buttons-wrapper">
      <button id="previous-button"><i class="fa-sharp fa-solid fa-arrow-left"></i> Previous</button>
      <button id="flip-button"><i class="fa-solid fa-repeat"></i> Flip Card</button>
      <button id="next-button">Next <i class="fa-sharp fa-solid fa-arrow-right"></i></button>
    </div><!-- /buttons-wrapper -->
  </div><!-- /card-wrapper -->
</div><!-- /card-body -->

</body>
</html>